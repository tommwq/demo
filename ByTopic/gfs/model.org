
从逻辑上看，GFS分为主服务器和块服务器。GFS的客户端以库的方式提供，客户端在访问GFS时，首先将文件名和块序号发送给主服务器，主服务器找到数据的块句柄和块位置，回应给客户端。接着客户端向块服务器发出请求，传入块句柄和读取范围，块服务器将数据传输给客户端。在GFS内部，主服务器向块服务器发送指令，块服务器向主服务器报告状态。存储在GFS上的文件都被分割成固定大小的块，每个块有自己的唯一编号，这个64位编号由主服务器生成。块服务器将块数据以普通文件的形式保存在Linux服务器上。处于可靠性的考虑，每个数据块都会保留多份副本，默认情况下保留3份副本。主服务器保存了全部文件系统的元数据，包括名字空间、访问控制信息、文件和数据块映射关系、数据块位置等。此外，主服务器还负责数据块租约管理、孤儿数据块管理、数据块迁移等工作。主服务器周期性的和每个块服务器通信，发送执行并接收状态报告。主服务器将全部元信息保存在内存中。主服务器不会持久化数据块的位置信息，在主服务器启动时，它会轮询块服务器，得到数据位置，然后通过周期性的通信更新块位置信息。每个数据块固定为64MB。客户端和块服务器不会缓存数据。

书签：2.6.3。







